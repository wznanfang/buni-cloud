server:
  port: 10000

spring:
  main:
    web-application-type: reactive
    allow-bean-definition-overriding: true
#  datasource:
#    driver-class-name: com.mysql.cj.jdbc.Driver
#    url: jdbc:mysql://localhost:3306/buni?useSSL=false&useUnicode=true&characterEncoding=UTF8&allowMultiQueries=true&rewriteBatchedStatements=true&serverTimezone=Asia/Shanghai
#    username: root
#    password: root
  data:
    redis:
      host: 127.0.0.1
      password: 123456
      database: 1

  cloud:
    nacos:
      discovery:
        server-addr: 127.0.0.1:8848
        namespace: buni

    gateway:
      globalcors:
        add-to-simple-url-handler-mapping: true
        corsConfigurations:
          '[/**]':
            allowedOriginPatterns: "*"
            allowedMethods: "*"
            allowedHeaders: "*"
            allowCredentials: true
            maxAge: 360000

      routes:
        - id: buni-user
          uri: lb://buni-user
          predicates: Path=/user/**
          filters:
            - StripPrefix=1
            - name: RequestRateLimiter
              args:
                redis-rate-limiter.replenishRate: 5
                redis-rate-limiter.burstCapacity: 5
                keyResolver: '#{@ipAddressKeyResolver}'
        - id: buni-file
          uri: lb://buni-file
          predicates: Path=/file/**
          filters:
            - StripPrefix=1
            - name: RequestRateLimiter
              args:
                redis-rate-limiter.replenishRate: 5
                redis-rate-limiter.burstCapacity: 5
                keyResolver: '#{@ipAddressKeyResolver}'


# knife4j 网关接口文档配置
knife4j:
  gateway:
    # 是否开启
    enabled: true
    # 排序规则(tag/operation排序自4.2.0版本新增),取值：alpha-默认排序规则，官方swagger-ui默认实现,order-Knife4j提供的增强排序规则，开发者可扩展x-order，根据数值来自定义排序
    tags-sorter: order
    operations-sorter: order
    # 指定服务发现的模式聚合微服务文档，并且是默认`default`分组
    strategy: manual
    # 子服务存在其他分组情况，聚合其他分组，只能手动配置
    routes:
      - name: 用户管理
        # 子服务存在其他分组情况，聚合其他分组
        url: /user/v3/api-docs?group=用户管理
        # 服务名称
        service-name: buni-user
        # 路由前缀
        context-path: /user
        order: 1
      - name: 文件管理
        url: /file/v3/api-docs?group=文件管理
        service-name: buni-file
        context-path: /file
        order: 2

buni:
  public-url:
    - /v3/api-docs/GET
    - /v1/login/POST
    - /v1/register/POST